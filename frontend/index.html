<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIDP Enhanced - Data Plotter</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Data Visualization Tool</h1>
        
        <!-- Controls -->
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <div class="grid grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-1">X-Axis</label>
                    <select id="xAxis" class="w-full p-2 border rounded">
                        <option value="">Select...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Y-Axis</label>
                    <select id="yAxis" class="w-full p-2 border rounded">
                        <option value="">Select...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Group By</label>
                    <select id="groupBy" class="w-full p-2 border rounded">
                        <option value="">None</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Chart Type</label>
                    <select id="chartType" class="w-full p-2 border rounded">
                        <option value="scatter">Scatter</option>
                        <option value="line">Line</option>
                        <option value="bar">Bar</option>
                        <option value="box">Box</option>
                    </select>
                </div>
            </div>
            <button id="updatePlot" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Update Plot
            </button>
        </div>
        
        <!-- File Upload -->
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h3 class="text-lg font-semibold mb-4">Upload Data</h3>
            <input type="file" id="fileInput" accept=".csv" class="mb-2">
            <button id="loadDemo" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 ml-2">
                Load Demo Data
            </button>
        </div>
        
        <!-- Plot Area -->
        <div class="bg-white p-6 rounded-lg shadow">
            <div id="plotDiv" style="height: 600px;"></div>
        </div>
    </div>

    <script>
        let currentData = [];
        let columns = [];

        // Demo data
        const demoData = [
            {Displacement: 0.1, Load: 150, Temperature: 25, Adhesive: "Fuller", TestCase: "RT"},
            {Displacement: 0.2, Load: 310, Temperature: 25, Adhesive: "Fuller", TestCase: "RT"},
            {Displacement: 0.3, Load: 450, Temperature: 25, Adhesive: "Fuller", TestCase: "RT"},
            {Displacement: 0.4, Load: 620, Temperature: 25, Adhesive: "Fuller", TestCase: "RT"},
            {Displacement: 0.5, Load: 780, Temperature: 25, Adhesive: "Fuller", TestCase: "RT"},
            {Displacement: 0.1, Load: 120, Temperature: -40, Adhesive: "Sika", TestCase: "Cold"},
            {Displacement: 0.2, Load: 250, Temperature: -40, Adhesive: "Sika", TestCase: "Cold"},
            {Displacement: 0.3, Load: 380, Temperature: -40, Adhesive: "Sika", TestCase: "Cold"},
            {Displacement: 0.4, Load: 510, Temperature: -40, Adhesive: "Sika", TestCase: "Cold"},
            {Displacement: 0.5, Load: 630, Temperature: -40, Adhesive: "Sika", TestCase: "Cold"}
        ];

        function loadData(data) {
            currentData = data;
            columns = Object.keys(data[0]);
            
            // Populate dropdowns
            const selects = ['xAxis', 'yAxis', 'groupBy'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = selectId === 'groupBy' ? '<option value="">None</option>' : '<option value="">Select...</option>';
                
                columns.forEach(col => {
                    const option = document.createElement('option');
                    option.value = col;
                    option.textContent = col;
                    select.appendChild(option);
                });
            });
            
            // Set default values
            document.getElementById('xAxis').value = 'Displacement';
            document.getElementById('yAxis').value = 'Load';
            document.getElementById('groupBy').value = 'Adhesive';
            
            updatePlot();
        }

        function updatePlot() {
            const xAxis = document.getElementById('xAxis').value;
            const yAxis = document.getElementById('yAxis').value;
            const groupBy = document.getElementById('groupBy').value;
            const chartType = document.getElementById('chartType').value;
            
            if (!xAxis || !yAxis || currentData.length === 0) {
                document.getElementById('plotDiv').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Please select X and Y axes</div>';
                return;
            }
            
            let traces = [];
            
            if (groupBy && groupBy !== '') {
                // Group data
                const groups = {};
                currentData.forEach(row => {
                    const group = row[groupBy];
                    if (!groups[group]) groups[group] = [];
                    groups[group].push(row);
                });
                
                // Create trace for each group
                Object.entries(groups).forEach(([groupName, groupData]) => {
                    traces.push({
                        x: groupData.map(row => row[xAxis]),
                        y: groupData.map(row => row[yAxis]),
                        name: groupName,
                        type: chartType === 'line' ? 'scatter' : chartType,
                        mode: chartType === 'line' ? 'lines+markers' : chartType === 'scatter' ? 'markers' : undefined
                    });
                });
            } else {
                // Single trace
                traces.push({
                    x: currentData.map(row => row[xAxis]),
                    y: currentData.map(row => row[yAxis]),
                    type: chartType === 'line' ? 'scatter' : chartType,
                    mode: chartType === 'line' ? 'lines+markers' : chartType === 'scatter' ? 'markers' : undefined
                });
            }
            
            const layout = {
                title: `${yAxis} vs ${xAxis}`,
                xaxis: { title: xAxis },
                yaxis: { title: yAxis },
                height: 600
            };
            
            Plotly.newPlot('plotDiv', traces, layout, {responsive: true});
        }

        // Event listeners
        document.getElementById('updatePlot').addEventListener('click', updatePlot);
        document.getElementById('loadDemo').addEventListener('click', () => loadData(demoData));
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',');
                    const data = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',');
                            const row = {};
                            headers.forEach((header, index) => {
                                const value = values[index]?.trim();
                                row[header.trim()] = isNaN(value) ? value : parseFloat(value);
                            });
                            data.push(row);
                        }
                    }
                    
                    loadData(data);
                };
                reader.readAsText(file);
            }
        });
        
        // Auto-load demo data
        setTimeout(() => loadData(demoData), 1000);
    </script>
</body>
</html>
